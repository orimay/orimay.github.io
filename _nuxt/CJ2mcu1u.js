var me=(o,t)=>(t=Symbol[o])?t:Symbol.for("Symbol."+o),fe=o=>{throw TypeError(o)};var A=(o,t,r)=>{if(t!=null){typeof t!="object"&&typeof t!="function"&&fe("Object expected");var n,u;r&&(n=t[me("asyncDispose")]),n===void 0&&(n=t[me("dispose")],r&&(u=n)),typeof n!="function"&&fe("Object not disposable"),u&&(n=function(){try{u.call(this)}catch(d){return Promise.reject(d)}}),o.push([r,n,t])}else r&&o.push([r]);return t},V=(o,t,r)=>{var n=typeof SuppressedError=="function"?SuppressedError:function(s,e,m,g){return g=Error(m),g.name="SuppressedError",g.error=s,g.suppressed=e,g},u=s=>t=r?new n(s,t,"An error was suppressed during disposal"):(r=!0,s),d=s=>{for(;s=o.pop();)try{var e=s[1]&&s[1].call(s[2]);if(s[0])return Promise.resolve(e).then(d,m=>(u(m),d()))}catch(m){u(m)}if(r)throw t};return d()};import{d as ye,aU as De,K as Ue,A as te,E as oe,z as be,L as Te,aj as Ve,aV as Ee,_ as Oe,aW as $e,aX as He,aY as ne,a8 as he,s as E,al as le,k as de,aZ as ve,ae as Me,B as W,D as z,J as B,av as We,I as ge,ac as ze,aS as H,aK as Ke,aI as je,a_ as we,a$ as qe,b0 as pe}from"#entry";import{_ as Ye}from"./BeLkrz8m.js";import{u as Ge}from"./Cn1eMX6q.js";import{u as Je}from"./D61i_Jxt.js";import{r as ee}from"./CN5EsVXz.js";class Xe{m_open=null;m_gate;constructor(){this.close()}get gate(){return new Promise(async t=>{const r=this.m_gate;await this.m_gate,this.m_gate!==r&&await this.gate,t()})}open(){this.m_open!==null&&(this.m_open(),this.m_open=null)}close(){const t=this.m_open;this.m_gate=new Promise(r=>this.m_open=r),t!==null&&t()}m_inUse=0;use(t){return++this.m_inUse,this.close(),{[Symbol.dispose]:()=>!--this.m_inUse&&(t===void 0||t())&&this.open()}}}function Ze(o,t){for(const r of o)if(t.has(r))return r}const Qe=new Set,_e="1000ms",et=ye({__name:"LoadingIndicator",props:{show:{type:Boolean}},setup(o){return De(t=>({e891906c:_e})),(t,r)=>(te(),Ue(Ee,{name:"loading-indicator"},{default:oe(()=>[o.show?(te(),be("div",{key:0,class:"before:animate-load before:bg-picked-neon relative before:absolute before:inset-x-0 before:top-0 before:h-1 before:-translate-y-0.5 before:rounded-full before:opacity-0 before:transition-opacity before:[animation-delay:var(--duration)]",style:Ve({"--duration":_e})},null,4)):Te("",!0)]),_:1}))}}),tt=Object.assign(Oe(et,[["__scopeId","data-v-0132c88c"]]),{__name:"ALoadingIndicator"}),ot={ref:"filler-upper"},nt={ref:"filler-lower"},$=450;function lt(){return new Promise(o=>requestAnimationFrame(()=>requestAnimationFrame(o)))}class at{constructor(t){this.m_msDuration=t}m_items=ne(new Set);async add(t){this.m_items.add(t),await H(),await H(),await lt(),await qe(this.m_msDuration),this.m_items.delete(t)}has(t){return this.m_items.has(t)}delete(t){return this.m_items.delete(t)}[Symbol.iterator](){return this.m_items[Symbol.iterator]()}}function st(o,t,r){let n=null;le(Ke(r),d=>{if(n?.disconnect(),d===null){n=null;return}n=new IntersectionObserver(s=>{for(const e of s)t(e.target,e.isIntersecting)},d)},{immediate:!0});const u=E(!1);return le(()=>u.value?Qe:je(o),(d,s)=>{if(n!==null){if(s!==void 0)for(const e of s)e!==null&&(d.has(e)||n.unobserve(e));for(const e of d)e!==null&&(s===void 0||!s.has(e))&&n.observe(e)}},{immediate:!0}),{track(d,s){n?.[s?"observe":"unobserve"](d)},suspend(){return u.value=!0,{async[Symbol.asyncDispose](){u.value=!1,await we(),await we()}}}}}const it=ye({__name:"ScrollLoader",props:{load:{type:Function},getKey:{type:Function,default:$e},loadThresholdDistance:{},itemsToPreload:{default:20}},setup(o,{expose:t}){const{elScrollArea:r,elScrollView:n}=Ge();function u(){return r.value?.offsetHeight??0}const d=new He,s=new at($),e=ne([]),m=he("filler-lower"),g=he("filler-upper"),ae=E(!1),se=E(!1),K=ne(new Set),{item2el:S,el2item:Se,bindRef:Ie,trackCallbacks:Fe}=Je(HTMLElement),{track:Ne,suspend:j}=st(()=>new Set([g.value,...e.map(i=>S.get(i)?.deref()??null),m.value]),(i,l)=>{if(i===g.value){se.value=l;return}if(i===m.value){ae.value=l;return}const y=Se.get(i)?.deref();y!==void 0&&K[l?"add":"delete"](y)},()=>({root:n.value,rootMargin:`${o.loadThresholdDistance??(n.value?.offsetHeight??0)*2}px 0px`,threshold:.1}));Fe.add(Ne);const L=E(!0),R=E(!0),ie=E(!1);le([()=>e.length,()=>R.value||L.value],([i])=>ie.value=!i);const q=de(()=>R.value&&ae.value);async function xe(i){const l=new Set(e),[y,x]=await o.load({after:i??null,limit:o.itemsToPreload}),c=new Set(x);if(n.value===null||g.value===null)return!1;const f=n.value.scrollTop;if(i!==void 0&&e.length>0&&e[e.length-1]!==i){let h=i===null?null:e.lastIndexOf(i);if(h!==-1){h??=-1;for(const p of e.slice(h+1))c.has(p)||l.delete(p)}}{const h=u();for(const _ of e){if(K.has(_))break;c.has(_)||(l.delete(_),S.get(_)?.deref()?.remove())}const p=u(),T=h-p;if(T!==0){const _=g.value.style,P=parseFloat(_.height)||0;_.height=`${P+T}px`,L.value=!0}}const w=u();for(const h of c)l.delete(h),l.add(h);const{animateChildren:I}=ee(l.intersection(c),h=>S.get(h)?.deref()??void 0);if(e.splice(0,e.length,...l),await H(),m.value===null)return!1;const b=u()-w,N=m.value.style;N.height=`${Math.max(0,(parseFloat(N.height)||0)-b)}px`;try{return n.value.scrollTop=f,c.size<o.itemsToPreload?(R.value=!1,N.height="0px",!1):!0}finally{await I($)}}ve(q,async()=>{var w=[];try{await Y.gate;const i=A(w,await d.lock());for(;q.value;){var l=[];try{const N=A(l,j(),!0);if(!await xe(e[e.length-1]))break;await pe()}catch(y){var x=y,c=!0}finally{var f=V(l,x,c);f&&await f}}}catch(I){var F=I,b=!0}finally{V(w,F,b)}},{immediate:!0});const re=de(()=>L.value&&se.value&&!q.value);async function Ce(i){const l=new Set(e.toReversed()),[y,x]=await o.load({before:i??null,limit:o.itemsToPreload}),c=new Set(x.reverse());if(n.value===null||m.value===null)return!1;let f=n.value.scrollTop;{const T=u();for(let C=e.length-1;C>-1;--C){const k=e[C];if(K.has(k))break;c.has(k)||(l.delete(k),S.get(k)?.deref()?.remove())}const _=u(),P=T-_;if(P!==0){const C=m.value.style,k=parseFloat(C.height)||0;C.height=`${k+P}px`,R.value=!0}}const w=u();for(const T of c)l.delete(T)||s.add(T),l.add(T);const{animateChildren:I}=ee(l.intersection(c),T=>S.get(T)?.deref()??void 0);if(e.splice(0,e.length,...[...l].reverse()),await H(),g.value===null)return!1;const b=u()-w,N=g.value.style,h=parseFloat(N.height)||0,p=b-h;N.height=`${h-(b-p)}px`,f+=p;try{return n.value.scrollTop=f,c.size<o.itemsToPreload?(L.value=!1,n.value.scrollTop-=h,N.height="0px",!1):!0}finally{await I($)}}ve(re,async()=>{var w=[];try{await Y.gate;const i=A(w,await d.lock());for(;re.value;){var l=[];try{const N=A(l,j(),!0);if(!await Ce(e[0]))break;await pe()}catch(y){var x=y,c=!0}finally{var f=V(l,x,c);f&&await f}}}catch(I){var F=I,b=!0}finally{V(w,F,b)}},{immediate:!0});const Y=new Xe;async function G(i){var M=[];try{const l=A(M,Y.use(()=>(e.length===0&&(L.value=!1,R.value=!1),!0)));const y=A(M,await d.lock());const x=A(M,j(),!0);const c=new Set;if(n.value===null)return;const f=n.value?.getBoundingClientRect();function w(a){if(a===null)return!1;const v=a.getBoundingClientRect();return v.top>=f.top&&v.top<=f.bottom||v.bottom>=f.top&&v.bottom<=f.bottom}function I(a){return w(a)?(c.add(a),!0):!1}const F=new Set;I(g.value);I(m.value);for(const a of e){const v=S.get(a)?.deref();if(v!==void 0){if(I(v))F.add(a);else if(F.size>2)break}}const b=new Set(e);const[N,h]=await T();if(m.value===null||g.value===null||n.value===null)return;const p=new Set(N);async function T(){try{const a=i?.anchor;if(a!==void 0){const[X,Z]=await o.load({limit:1+o.itemsToPreload*2,range:[a]});return[Z,X]}const v=e.length&&!i?.purge,[U,O]=await o.load({...v?{limit:Math.max(F.size,o.itemsToPreload*2),range:[...F]}:{limit:o.itemsToPreload,range:[]}});return[O,v?void 0:U]}finally{L.value=!0,R.value=!0}}const _=Ze(b,p);const P=c.has(m.value)?m.value:_!==void 0?S.get(_)?.deref()??null:null;const C=P?.getBoundingClientRect().top??0;const{animateChildren:k}=ee(b.intersection(p),a=>S.get(a)?.deref()??void 0);for(const a of b)!p.has(a)&&!F.has(a)&&S.get(a)?.deref()?.remove();const ke=g.value.style;ke.height="0px";const Ae=m.value.style;Ae.height="0px";const ce=e.length;e.splice(0,e.length,...p);if(h!==null)for(const a of p)s.add(a);await H();const D=h?S.get(h)?.deref()??null:null;let J=0;if(D!==null){D.dataset.anchor="";const a=D.parentElement.querySelectorAll("&>:is(.height-leave-active,[data-anchor])");delete D.dataset.anchor;let v=0;for(const Q of a){if(Q===D)break;c.has(Q)&&(v+=Q.getBoundingClientRect().height)}const U=D.getBoundingClientRect(),O=n.value.getBoundingClientRect(),X=U.top,Z=O.top+(U.height>O.height?0:(O.height-U.height)*.5)+v;J=X-Z}else{const a=ce===0?h:_,v=ce>0&&c.has(m.value)?m.value:a!=null?S.get(a)?.deref()??null:null;if(v===null)return;J=v.getBoundingClientRect().top-C}const Le=Math.round(n.value.scrollTop+J);n.value.scrollTop=Le;await k($)}catch(Re){var Be=Re,Pe=!0}finally{var ue=V(M,Be,Pe);ue&&await ue}}return t({refresh:G}),(i,l)=>{const y=tt,x=We,c=Ye;return te(),be(Me,null,[W("div",ot,null,512),z(y,{show:B(L)},null,8,["show"]),z(x,{items:B(e),"get-key":o.getKey,"ms-duration":$},{item:oe(({item:f,index:w})=>[W("div",{ref:B(Ie)(f),class:ze({"no-transition-height":B(s).has(f)})},[ge(i.$slots,"item",{item:f,index:w,items:B(e),refresh:G})],2)]),_:3},8,["items","get-key"]),z(y,{show:B(R)},null,8,["show"]),W("div",nt,null,512),z(c,{"no-appear":""},{default:oe(()=>[B(ie)?ge(i.$slots,"empty",{key:0,refresh:G},()=>[l[0]||(l[0]=W("div",{class:"absolute inset-0 flex items-center justify-center"}," NO ITEMS ",-1))]):Te("",!0)]),_:3})],64)}}}),dt=Object.assign(it,{__name:"AScrollLoader"});export{dt as A};
