import{_ as O,u as P,M as H,a as U}from"./CN5EsVXz.js";import{d as C,a7 as j,K as L,A as V,aj as z,ac as F,s as T,T as A,ak as M,a9 as x,al as N,W as p,k as S,z as q,D as y,J as i,am as G,an as J,X as B,U as K,a1 as W,G as X,r as Q,a8 as Y,ao as Z,E as ee,B as ae}from"#entry";import{A as te}from"./CJ2mcu1u.js";import{_ as ne}from"./D75ubYjO.js";import{_ as oe}from"./CWJcnSqZ.js";import"./BeLkrz8m.js";import"./Cn1eMX6q.js";import"./D61i_Jxt.js";import"./DtXqOkeS.js";const le=C({__name:"InputHue",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(o){const n=j(o,"modelValue");return(_,m)=>{const e=ne;return V(),L(e,{modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=d=>n.value=d),min:0,max:360,class:F(["[&_input]:range-track:bg-linear-to-r/longer [&_input]:range-track:from-(--red-neon) [&_input]:range-track:to-(--red-neon)","[&_input]:range-thumb:outline [&_input]:range-thumb:outline-picked-deep"]),style:z({"--color-picked":`oklch(from currentColor l c ${n.value} / 1)`,"--red-neon":"oklch(from red var(--oklch-l-neon) var(--oklch-c-neon) h / 60%)"})},null,8,["modelValue","style"])}}}),ue=Object.assign(le,{__name:"AInputHue"}),se=C({__name:"Tags",props:{tagIds:{},onTagAdd:{type:Function},onTagRemove:{type:Function}},emits:["tag-name"],setup(o,{expose:n,emit:_}){const m=_,e=T(A.fromData({})),d=M(async()=>{const[t,u]=await p.getTags({ids:Array.from(o.tagIds),name:e.value.name});return u},[]);async function l(t={}){const u=A.fromData(t),f=await p.getTagHues();return u.hue=J(f),u}let c=null,v=null,r=null;x(()=>m("tag-name",e.value.name)),N([()=>e.value.id,()=>e.value.name],async([t,u],[f])=>{const g=await p.findTag({name:u,notId:t});g!==null?c=g:(c=null,(f!==t||t===void 0)&&(v=u)),t===void 0&&(g!==null?(r=e.value.hue,e.value.hue=g.hue):r!==null&&(e.value.hue=r,r=null))},{immediate:!0});async function I(t){await o.onTagAdd(t)}async function a(){c!==null?await o.onTagAdd(c):(await p.set(e.value),await o.onTagAdd(e.value)),e.value=await l()}async function k(t){await o.onTagRemove(t),e.value=await l()}let h=Promise.resolve(),s=null;async function R(t){await h,s=A.toData(t),e.value=t}async function b(){s!==null&&(e.value.name=s.name,e.value.hue=s.hue,s=null),e.value=await l()}async function D(){e.value.name.trim()?(c!==null&&v!==null&&(e.value.name=v),e.value=await l()):await b()}n({tagPush:I});const E=S(()=>e.value.id?{iconLeft:"cancel",iconClickLeft:b,iconRight:"unlink",iconClickRight(){k(e.value)},onBlur(){h=D()}}:e.value.name?{iconLeft:"cancel",async iconClickLeft(){e.value=await l()},iconRight:"save",iconClickRight:a}:{});return(t,u)=>{const f=O,g=ue,$=oe;return V(),q("div",null,[y(f,{class:"mt-2 [&_.tag]:p-[1em]",tags:i(d),onTagClick:R},null,8,["tags"]),y(g,{modelValue:i(e).hue,"onUpdate:modelValue":u[0]||(u[0]=w=>i(e).hue=w)},null,8,["modelValue"]),y($,G({modelValue:i(e).name,"onUpdate:modelValue":u[1]||(u[1]=w=>i(e).name=w),modelModifiers:{trim:!0},class:"col-span-2",style:{"--color-picked":`oklch(from currentColor l c ${i(e).hue} / alpha)`}},i(E),{placeholder:"Tag name"}),null,16,["modelValue","style"])])}}}),ce=Object.assign(se,{__name:"OEditorTags"}),ie={class:"py-2"},he=C({__name:"tags",props:{taskId:{}},setup(o){const n=M(()=>B.get(o.taskId),B.tryGet(o.taskId)??K.create()),{setPageLayout:_}=X(),m=P({taskId:()=>o.taskId,page:"tags"}),e=T(""),d=T();W(()=>{_(()=>({cmpHeader:{cmp:H,bind:{task:n.value,path:o.taskId}},cmpFooter:{cmp:ce,bind:{tagIds:n.value.tagIds,onTagAdd:a=>n.value.tagAdd(a),onTagRemove:a=>n.value.tagRemove(a),"onTag-name":a=>e.value=a,ref:a=>d.value=a}},menuItems:m}))});const l=Q({name:"",notIds:[],anchor:void 0});x(()=>l.value.name=e.value);const c=Y("tag-loader");async function v(){if(!n.value.id||!c.value)return;const a=l.value.anchor!==void 0?await p.get(l.value.anchor):void 0;c.value.refresh({anchor:a,purge:r.value})}const r=T(!0);Z([c,()=>n.value.id,()=>l],v,{deep:!0,debounce:()=>r.value?0:300}),x(()=>l.value.notIds=[...n.value.tagIds]);function I(a){return p.getTags({...l.value,limit:a.limit,range:a.range?.map(k=>k.id),before:a.before?.id,after:a.after?.id})}return(a,k)=>{const h=U;return V(),L(i(te),{ref:"tag-loader",load:I,"get-key":s=>s.id},{item:ee(({item:s})=>[ae("div",ie,[y(h,{tag:s,class:"text-lg! !p-4",onClick:R=>i(d)?.tagPush(s)},null,8,["tag","onClick"])])]),_:1},8,["get-key"])}}});export{he as default};
