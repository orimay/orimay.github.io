import{M as g,_ as q}from"./DAPKcV3g.js";import{u as M,M as w,o as L}from"./CN5EsVXz.js";import{d as h,u as C,aG as R,ak as b,X as r,U as x,a1 as A,G,r as O,ag as S,k as _,Z as F,ai as H,s as c,a9 as m,aH as P,al as f,K as Q,A as U,J as u}from"#entry";import"./DtXqOkeS.js";import"./CJ2mcu1u.js";import"./BeLkrz8m.js";import"./Cn1eMX6q.js";import"./D61i_Jxt.js";import"./CWJcnSqZ.js";import"./Dq2_-K6K.js";const W=h({__name:"relations",props:{taskId:{}},setup(t){const p=C(),i=R(),n=b(()=>r.get(t.taskId),r.tryGet(t.taskId)??x.create()),{setPageLayout:y}=G(),I=M({taskId:()=>t.taskId,page:()=>o.value});A(()=>{y(()=>({cmpHeader:{cmp:w,bind:{task:n.value,path:t.taskId}},cmpFooter:{key:"list-footer",cmp:g,bind:{relation:l.value,modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,"onSave-task":async a=>{await r.set(a),await F.emit(n.value.id,`${l.value.id}.add`,a),e.value.title="",H.value=[a.id]},filterDefaults:s.value}},menuItems:I}))});const o=c("subtasks");m(()=>{i.query.id&&(o.value=i.query.id)});const B=P(()=>n.value),l=_(()=>B.value.get(o.value)),s=O({title:"",isDone:!1,isPast:!1,isBlocked:!1,isOutdated:!1,tagIds:[],notTagIds:[]}),e=S("filter-query",()=>({...s.value}));m(()=>e.value.ids=[...l.value.ids]),f([()=>e.value,()=>t.taskId,()=>i.query.id],()=>e.value.title="",{immediate:!0});const d=c(e.value.isBlocked),v=c(e.value.isDone);return f(o,a=>{a==="blocked"?(d.value=e.value.isBlocked,e.value.isBlocked=!0,s.value.isBlocked=!0):(e.value.isBlocked=d.value,s.value.isBlocked=!1),a==="blockers"?(v.value=e.value.isDone,e.value.isDone=void 0,s.value.isDone=void 0):(e.value.isDone=v.value,s.value.isDone=!1)},{immediate:!0}),(a,k)=>{const D=q;return U(),Q(D,{query:u(e),relation:u(l),onOpenTask:k[0]||(k[0]=T=>u(L)(u(p),T))},null,8,["query","relation"])}}});export{W as default};
