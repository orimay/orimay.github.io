import{_ as R}from"./4K8f6mhm.js";import{N as h,O as E,P as T,Q as f,R as $,T as V,S as L,U as O,V as U,W as I,X as N,Y as j,Z as F,$ as P,a0 as M,d as q,u as W,a1 as J,G as H,h as z,a2 as G,s as x,H as K,z as Q,A as b,D as p,K as X,L as Y,E as g,F as w,J as y,a3 as _,B as Z,a4 as tt,C as at,M as st,a5 as C}from"#entry";const et={download(n,t){const o=URL.createObjectURL(new Blob([t])),e=document.createElement("a");return e.href=o,e.setAttribute("download",n.split("/").pop()??""),e.click(),URL.revokeObjectURL(o),Promise.resolve()}};class m extends h(){constructor(t){super(E,t,()=>{})}static fromData(t){return new m(t)}static toData(t){return T(E,t.dataDec)}}const S=new class{async export(){const n=await f.query("SELECT *, type::record(id) AS id FROM task"),t=await f.query("SELECT *, type::record(id) AS id FROM tag"),o=await f.query("SELECT VALUE meta::id(id) FROM line"),e=m.fromData({version:1,tasks:n,tags:t,lines:o}),a=m.toData(e),d=`focus-assistant.${Temporal.Now.plainDateTimeISO().toJSON().slice(0,16).replaceAll(/[^\d_]/g,"")}.json`;return await et.download(`Download/${d}`,$(a,2)),{path:`Download/${d}`,tasksCount:n.length,tagsCount:t.length}}async import(n){try{const t=m.fromData(n),o=t.tags.map(a=>V.fromData(T(L,a))),e=t.tasks.map(a=>O.fromData(T(U,a)));for(const a of o)await I.set(a,{forget:!0});for(const a of e)await N.set(a,{forget:!0});for(const a of o)await j.emit(a.id,"new");for(const a of e)await F.emit(a.id,"new");console.log({backup:t});for(const a of t.lines??[])await f.query("UPSERT type::thing('line', $line)",{line:a});return{errors:[],tasksCount:e.length,tagsCount:o.length,linesCount:t.lines?.length??0}}catch(t){if(t instanceof P)return{errors:[...M(E,n)],tasksCount:0,tagsCount:0};throw console.log({e:t}),t}}},lt=q({__name:"settings",setup(n){const{setPageLayout:t}=H(),o=W();J(()=>{t(()=>({cmpHeader:{cmp:()=>z("span",{class:"font-mono flex justify-center items-center p-2"},"focus-assistant@0.0.10024")},cmpFooter:null,menuItems:[{key:"tasks",label:"Tasks",icon:"tasks:list",onClick(){o.push("/task/list")}}]}))});const e=G(),a=x(!1);async function d(i){if(i!==null)try{a.value=!0;const s=await i.text(),{errors:l,tagsCount:k,tasksCount:u}=await S.import(JSON.parse(s));e.refresh(),C.show(l.length?`Failed to import tags and tasks: ${l[0].message}`:`Successfully imported ${k} tags and ${u} tasks`)}catch{C.show("Failed to import tags and tasks")}finally{a.value=!1}}const c=x(!1);async function A(){try{c.value=!0;const{path:i,tagsCount:s,tasksCount:l}=await S.export();C.show(`Successfully exported ${s} tags and ${l} tasks to ${i??void 0}`)}finally{c.value=!1}}const{isPWA:B,canUseInBrowser:D}=K();return(i,s)=>{const l=R,k=tt,u=st;return b(),Q("div",null,[p(l,{modelValue:y(a),"onUpdate:modelValue":s[0]||(s[0]=r=>_(a)?a.value=r:null)},{default:g(()=>[...s[4]||(s[4]=[w("Importing backup",-1)])]),_:1},8,["modelValue"]),p(u,{class:"relative"},{default:g(()=>[p(k,{name:"file-download"}),s[5]||(s[5]=w(" "+at("Import backup")+" ",-1)),Z("input",{class:"absolute inset-0 opacity-0",type:"file",accept:".fa,.json",onChange:s[1]||(s[1]=async r=>{const v=r.target;await d(v.files?.[0]??null),v.value=null})},null,32)]),_:1}),p(l,{modelValue:y(c),"onUpdate:modelValue":s[2]||(s[2]=r=>_(c)?c.value=r:null)},{default:g(()=>[...s[6]||(s[6]=[w("Exporting backup",-1)])]),_:1},8,["modelValue"]),p(u,{icon:"file-download",label:"Export backup",onClick:A}),y(B)?Y("",!0):(b(),X(u,{key:0,icon:"pwa",label:"Use in PWA",onClick:s[3]||(s[3]=r=>D.value=!1)}))])}}});export{lt as default};
